# Описание пайплайна для анализа выживаемости

Этот пайплайн разработан для выполнения анализа выживаемости с использованием кривых Каплана-Майера и Лог-ранг теста. Основной запрос лаборатории заключался в создании универсального кода, который мог бы применяться к разным наборам данных, а не только к исследованиям хронического лимфолейкоза (ХЛЛ). Поэтому в реализации отсутствует явное указание на группы, их признаки или специфику исследования — пайплайн может работать с любыми группировками, заданными в данных.

---

## Общая структура

### **1. Основная идея**
Пайплайн предназначен для автоматической обработки файлов данных, выполнения статистического анализа различий между группами и сохранения результатов в удобном формате. Этот код позволяет:
- Автоматизировать работу с несколькими файлами данных.
- Получить как визуализацию (графики Каплана-Майера), так и численные результаты (p-value для Лог-ранг теста).
- Работать с различными наборами данных без необходимости их адаптации под конкретные задачи.

### **2. Универсальность**
Пайплайн не ориентирован на конкретное заболевание или исследование. В данных допускаются любые группы, которые можно анализировать. Это упрощает его применение для разных целей, включая:
- Сравнение подтипов заболеваний.
- Оценку эффективности разных терапевтических подходов.
- Анализ влияния различных факторов (например, возраста, пола, мутаций и т.д.) на выживаемость.

---

## Основные элементы

### **1. Подготовка данных (`read_and_prepare_data`)**
Эта функция выполняет базовую проверку и обработку данных:
- Считывает файл `.csv` с данными, где должны быть три обязательные колонки:
  - `Time` — время наблюдения.
  - `Status` — статус события (0 — выживание, 1 — наступление события).
  - `Group` — группы для сравнения.
  - Разделителем в файле обязательно должна быть `;`.
- Преобразует данные:
  - Значения времени приводятся к числовому формату.
  - Группы переводятся в факторный тип для корректной работы статистических методов.
- Если данные не соответствуют требованиям (например, отсутствует одна из колонок), работа пайплайна останавливается с сообщением об ошибке.

...

## Результаты

После выполнения пайплайна вы получите:
1. **Графики выживаемости:**
   - Каждый график показывает различия между группами с использованием кривых Каплана-Майера.
   - Файлы сохраняются в папке `results/` с указанием даты выполнения анализа.
2. **Таблица результатов Лог-ранг теста:**
   - В таблице перечислены все обработанные файлы и их p-value.
   - Это позволяет быстро оценить статистическую значимость различий между группами.

...

## Почему этот код нужен
Лаборатория запросила универсальный инструмент, который подходит для широкого спектра задач. Именно поэтому код не содержит привязки к конкретным группам или условиям исследования. Такой подход позволяет использовать его:
- В разных экспериментах без необходимости модификации.
- Для анализа больших наборов данных с минимальными затратами времени.

Этот пайплайн — базовый, но мощный инструмент для анализа выживаемости, который легко адаптируется к любым исследованиям.

### Дашборд для анализа выживаемости

Дашборд доступен по ссылке [https://polinavd.shinyapps.io/ingeneering/](https://polinavd.shinyapps.io/ingeneering/). Это инструмент для интерактивного анализа выживаемости, где любой пользователь может загрузить свои данные, запустить анализ и получить результаты в удобной форме. Всё работает через графики Каплана-Майера и статистику Лог-ранг теста.

---

### Технологии и инструменты

#### **1. R**
Используется для обработки данных, статистических вычислений и построения графиков. Это базис всего проекта.

#### **2. Shiny**
Фреймворк для создания веб-приложений на R. Позволяет сделать интерфейс интерактивным, чтобы пользователь мог работать с данными прямо в браузере.

#### **3. Основные библиотеки**
- **`shiny`**: за интерфейс.
- **`survival`**: для анализа выживаемости, включая Лог-ранг тест.
- **`survminer`**: для красивых графиков Каплана-Майера.
- **`ggplot2`**: чтобы кастомизировать визуализацию.
- **`DT`**: чтобы выводить интерактивные таблицы с результатами.

---

### Как устроен дашборд

#### **1. Интерфейс пользователя (UI)**
Интерфейс построен с помощью `fluidPage()`. Включает:
- **Загрузка данных:** поле для выбора файла `.csv`, кнопки для запуска анализа и скачивания результатов.
- **Графики:** вкладка с визуализацией Каплана-Майера.
- **Результаты:** вкладка с таблицей p-value.

#### **2. Серверная часть**
На сервере происходит вся основная работа:
- **Проверка данных:** чтобы колонки `Time`, `Status`, `Group` были на месте.
- **Анализ выживаемости:** 
  - Генерация объекта `Surv` (время + статус).
  - Расчёт p-value с Лог-ранг тестом.
  - Построение графика Каплана-Майера.
- **Вывод:** результаты отображаются в виде графиков и таблиц, а ещё их можно скачать.

---

### Как создавался дашборд

1. **Сначала сделали пайплайн.**  
R-скрипты для анализа выживаемости (обработка данных, графики, тесты) адаптированы под многократное использование.

2. **Потом сделали интерфейс.**  
Добавили загрузку файлов, вывод графиков и таблиц.

3. **Тестировали.**  
Проверяли работу на локальной машине с реальными данными.

4. **Разместили.**  
Загрузили дашборд на [ShinyApps.io](https://www.shinyapps.io/) через:
   ```r
   rsconnect::deployApp(".")

